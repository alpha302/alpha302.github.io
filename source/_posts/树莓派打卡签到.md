---
title: 树莓派打卡签到
mathjax: true
copyright: true
comment: true
date: 2019-12-13 09:37:53
tags: 
- 树莓派
- 自动化
categories: 树莓派
---
实习要求：上班和下班必须要签到。我这么懒，实习是肯定要实习的，但是签到嘛，还是要想办法摸摸鱼的啦!


<!-- more -->

---
## 树莓派介绍
树莓派是一款信用卡大小的超小型电脑

![](https://raw.githubusercontent.com/alpha302/cloudimg/master/O28QLRC9U194I.png)

那么我们有个大胆的想法，能不能用树莓派实现打卡的心愿呢。好歹也是个计算机，对吧。

## 树莓派的购买及组装
[购买清单](https://projects.raspberrypi.org/en/projects/raspberry-pi-setting-up/2)

就我实际的使用而言，必需品：一块主板，网线，3个散热片，外壳，电源，16g sd卡，读卡器。

组装部分 https://projects.raspberrypi.org/en/projects/raspberry-pi-setting-up/4

大家拿着自己的板子(树莓派4)对照着图找就好了

![](https://raw.githubusercontent.com/alpha302/cloudimg/master/PJ3%252IPJ.png)

#### 装系统

我这里推荐大家装 [Raspbian Buster with desktop](https://www.raspberrypi.org/downloads/raspbian/) 对于官网NOOBS系统我尝试过了，对于我们没有买显示器的而言，不友好，需要额外的操作。

**系统下载完成，就需要烧录** 这里需要先SD卡格式化，使用 [SD Card Formatter](https://www.sdcard.org/downloads/formatter/index.html)(支持windows和mac)

![](https://raw.githubusercontent.com/alpha302/cloudimg/master/YMFTL%7BWDL%5BRD.png)

烧录系统到sd卡6
这里使用win32Diskimager 

链接：https://pan.baidu.com/s/1loQPydCsw9Cam8Us2CbpxQ 
提取码：wiis 
复制这段内容后打开百度网盘手机App，操作更方便哦



烧录完成，组装完成。设置ssh连接，最新的系统默认是未开启ssh，这里我们需要设置开启ssh。将SD卡连接到电脑上并打开，直接新建“SSH”文件（无后缀）即可

算了，接下来还有网线什么的连接。写起来太长，都还没到主菜。详细的设置大家可以参考
https://blog.csdn.net/weixin_43895902/article/details/100919851#_142

就我出现的几个问题给大家说一下。

- 1. ssh连接，我是在学校里，学校网络比较复杂。我是电脑使用无线连接手机热点，树莓派和电脑网线连接。无线网开启共享给以太网。cmd中arp-a查看分配的ip，一般树莓派默认是192.168.137.x 默认密码
raspberry 用户名 pi
- 2. 开启的vnc无法显示，这是因为你屏幕的分辨率问题，按教程修改就好
- 3. 自己的树莓派下载很慢，这时需要[设置软件源](https://zhuanlan.zhihu.com/p/35017671)
- 4. 不推荐大家使用swap分区，会有损sd卡的性能。装完系统默认是开启100mb的sd卡空间提供swap。

## 主菜到了，树莓派签到功能
树莓派直接放在公司里，有电有网，直接就能定位。除了让树莓派自动打卡，我还想让树莓派打卡完成之后给我发一封邮件。一步一步来

#### 设置邮件功能
配置msmtp和mutt自动发送邮件
  > mutt: 是一个Linux下的邮件程序，Mutt 更像一个文件管理器，只不过它管理的是email 
  > msmtp: 是Linux下一个非常简单易用的smtp客户端

```R
#安装
sudo apt install msmtp mutt
```

```r
# 配置msmtprc
cd /root               #进入用户根目录
touch msmtp.log        #创建日志文件
chmod 600 msmtp.log    #查看日志
touch .msmtprc         #创建.msmtprc文件
chmod 600 .msmtprc     #msmtprc权限
sudo nano .msmtprc     #添加如下内容


account default
host smtp.163.com    #需要开启163邮箱的SMTP服务
from xxx@163.com     #你的邮箱地址
auth plain
user xxx@163.com     #你的邮箱地址
password your_password   #是SMTP授权码
logfile /root/msmtp.log # 在发送邮件之后程序会把发送日志写到这个路径的文件里



#配置mutt
cd /root
touch .muttrc
sudo nano .muttrc  #添加以下内容，默认填就好了


set sendmail="/usr/bin/msmtp"
set use_from=yes
set realname="Alpha"  #收件人名字
set from="xxx@163.com"
set editor="vim"

```
```P
#测试
测试配置文件：msmtp -P
测试smtp服务器：msmtp -S
echo "你好，我是测试用的，谢谢" | mutt -s "你好啊" xxx@163.com

```



![](https://raw.githubusercontent.com/alpha302/cloudimg/master/OM%5B3SUTVJH413%24MM.png)

![](https://raw.githubusercontent.com/alpha302/cloudimg/master/52LEB88L0Y%7E_%60M%5BD.png)

![](https://raw.githubusercontent.com/alpha302/cloudimg/master/YVF38P%7ECZFXA90ID7.png)

#### 抓取定位包
我使用的是eteams打卡，它不支持pc端的签到，所以我只能使用模拟器代理去抓包。






















































一些自己使用的脚本：
- 1.定时ip任务: #!/bin/bash
```R
#!/bin/bash
  
# check network availability
  
# get the IP address of eth0, e.g. "192.168.16.5"
ETH0_IP_ADDR=`/sbin/ifconfig eth0 | sed -n "2,2p" | awk '{print substr($2,1)}'`
  
# send the Email
echo "Current time: `date '+%F %T'`. Enjoy it" | mutt -s "IP Address of Raspberry Pi: $ETH0_IP_ADDR" xxx@163.com

```
- 2.报告车况，车辆到站时间
```R
  
```